---
title: "Fleet Maker"
author: "Nate Lant"
date: "3/29/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

Read in the nodes and select the coordinates at random.
Then convert the coorinates to epsg:26912 (meters)

### How many ride hail vehicles should there be?

This is an important value, as general users will also request wavs, thus
preventing wheelchair users from using empty wavs.

Ideally, we should calibrate BEAM with an ideal number of ride hail vehicles,
then evaluate the change in wavs.

According to Yufei and the [SFCTA](https://www.sfcta.org/sites/default/files/2019-02/TNCs_Today_112917_0.pdf), 
there are roughly 21,000 TNC drivers in San Francisco (population 874,962).

Given this same ratio, there should be roughly *27,800* TNC drivers in Salt Lake 
County (population 1.16 million).

The sf-light scenario uses 500 ride hail vehicles in their simulation and I am thinking
that the ratio should be constant with population size of the scenario.

1 - population = 20,598; ride hail cars = 500; Make 32 of these the WAVs
2 - population = 115,601; ride hail cars = 2890;
3 - population = 567,932; ride hail cars = 14200;
4 - population = 248,740; ride hail cars = 6200;

## Data and conversion

```{r}
# nodes
nodes <- read_csv("R/data/nodes.csv")
# max ridehail vehicle ids is 500
wavs <- 16
cars <- 50
n <- wavs+cars

mySample <- nodes %>% 
  sample_n(n) %>%
  transmute(
    myId = 1:n,
    initialLocationX = xcoord,
    initialLocationY = ycoord
  )

```


## Generate new file

```{r}
ids <- read_csv("test/input_new/small_mix/ridehailfleet_wav.csv") 

idTable <- ids %>% transmute(myId = row_number(), id) 

table <- left_join(mySample, idTable) %>% 
  transmute(
    id, 
    rideHailManagerId = "GlobalRHM",
    vehicleType = ifelse(myId > wavs, "Car", "WAV"),
    initialLocationX, 
    initialLocationY,
    shifts = "{10:25200};{25300:80000}",
    geofenceX = NA,
    geofenceY = NA,
    geofenceRadius = NA
  )

write_csv(table, "test/input_new/small_mix/fleet_16.csv")

```

